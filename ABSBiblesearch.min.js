!function(){var _baseUrl="http://bibles.org/v2/";var _APIKey="";var _lastError="";var _fumsJs="";var _fumsJsIncluded=false;var _fumsInterval=null;var _fumsInjectionSuppression=false;var _async=true;var _debug=false;function ABSBiblesearch(){}ABSBiblesearch.prototype.turnOnLogging=function(){_debug=true};ABSBiblesearch.prototype.turnOffLogging=function(){_debug=false};ABSBiblesearch.prototype.setKey=function(key){_APIKey=key};ABSBiblesearch.prototype.getKey=function(){return _APIKey};ABSBiblesearch.prototype.setAsync=function(async){_async=async};ABSBiblesearch.prototype.getAsync=function(){return _async};ABSBiblesearch.prototype.lastError=function(){var e=_lastError;_lastError="";return e};ABSBiblesearch.prototype.search=function(options,callback){if(_APIKey===""){_lastError="API Key must be specified.";return false}if(!options||!options.query){_lastError="Please supply a query.";return false}var url=_baseUrl+"search.js?query="+options.query;if(options.version){url=url+"&version="+options.version}return this.json(url,callback)};ABSBiblesearch.prototype.versions=function(callback){if(_APIKey===""){_lastError="API Key must be specified.";return false}return this.json(_baseUrl+"versions.js",callback)};ABSBiblesearch.prototype.booksInVersion=function(options,callback){if(_APIKey===""){_lastError="API Key must be specified.";return false}if(!options||!options.version||options.version===""){_lastError="Must supply a version id.";return false}var url=_baseUrl+"versions/"+options.version+"/books.js";if(options.testament){url=url+"?testament="+options.testament}return this.json(url,callback)};ABSBiblesearch.prototype.versionsByLanguage=function(language,callback){if(_APIKey===""){_lastError="API Key must be specified.";return false}if(language===null||language===""){_lastError="Must supply a language.";return false}return this.json(_baseUrl+"versions.js?language="+language,callback)};ABSBiblesearch.prototype.versionInformation=function(version,callback){if(_APIKey===""){_lastError="API Key must be specified.";return false}if(version===null||version===""){_lastError="Must supply a version id.";return false}return this.json(_baseUrl+"versions/"+version+".js",callback)};ABSBiblesearch.prototype.book=function(options,callback){if(_APIKey===""){_lastError="API Key must be specified.";return false}if(!options||!options.version||options.version===""){_lastError="Must supply a version id.";return false}if(!options||!options.book||options.book===""){_lastError="Must supply a book id.";return false}var url=_baseUrl+"books/"+options.version+":"+options.book+".js";return this.json(url,callback)};ABSBiblesearch.prototype.chaptersInBook=function(options,callback){if(_APIKey===""){_lastError="API Key must be specified.";return false}if(!options||!options.version||options.version===""){_lastError="Must supply a version id.";return false}if(!options||!options.book||options.book===""){_lastError="Must supply a book id.";return false}var url=_baseUrl+"books/"+options.version+":"+options.book+"/chapters.js";return this.json(url,callback)};ABSBiblesearch.prototype.chapter=function(options,callback){if(_APIKey===""){_lastError="API Key must be specified.";return false}if(!options||!options.version||options.version===""){_lastError="Must supply a version id.";return false}if(!options||!options.book||options.book===""){_lastError="Must supply a book id.";return false}if(!options||!options.chapter||options.chapter===""){_lastError="Must supply a chapter number.";return false}var url=_baseUrl+"chapters/"+options.version+":"+options.book+"."+options.chapter+".js";if(options&&options.marginalia){url+="?include_marginalia="+options.marginalia}return this.json(url,callback)};ABSBiblesearch.prototype.chapterVerseList=function(options,callback){if(_APIKey===""){_lastError="API Key must be specified.";return false}if(!options||!options.version||options.version===""){_lastError="Must supply a version id.";return false}if(!options||!options.book||options.book===""){_lastError="Must supply a book id.";return false}if(!options||!options.chapter||options.chapter===""){_lastError="Must supply a chapter number.";return false}var url=_baseUrl+"chapters/"+options.version+":"+options.book+"."+options.chapter+"/verses.js";if(options.start||options.end){url=url+"?"}if(options.start&&options.start!==""){url=url+"start="+options.start+"&"}if(options.end&&options.end!==""){url=url+"end="+options.end}return this.json(url,callback)};ABSBiblesearch.prototype.versesByKeyword=function(options,callback){if(_APIKey===""){_lastError="API Key must be specified.";return false}if(!options||!options.keyword||options.keyword===""){_lastError="Must supply a keyword.";return false}var url=_baseUrl+"verses.js?";for(var key in options){url=url+key+"="+options[key]+"&"}url=url.substring(0,url.length-1);return this.json(url,callback)};ABSBiblesearch.prototype.versesByRef=function(options,callback){if(_APIKey===""){_lastError="API Key must be specified.";return false}if(!options||!options.version||options.version===""){_lastError="Must supply a version.";return false}if(!options||!options.book||options.book===""){_lastError="Must supply a book.";return false}if(!options||!options.chapter||options.chapter===""){_lastError="Must supply a chapter.";return false}if(!options||!options.verse||options.verse===""){_lastError="Must supply a verse.";return false}var url=_baseUrl+"verses/"+options.version+":"+options.book+"."+options.chapter+"."+options.verse+".js";return this.json(url,callback)};ABSBiblesearch.prototype.passages=function(options,callback){if(_APIKey===""){_lastError="API Key must be specified.";return false}if(!options||!options.passages||options.passages===""){_lastError="Must supply a passage.";return false}var url=_baseUrl;if(options.version&&options.version!==""){url=url+options.version+"/"}url=url+"passages.js?q[]="+options.passages;return this.json(url,callback)};ABSBiblesearch.prototype.bookgroups=function(options,callback){if(_APIKey===""){_lastError="API Key must be specified.";return false}var url=_baseUrl+"bookgroups";if(options&&options.id&&options.id!==""){url=url+"/"+options.id}url=url+".js";return this.json(url,callback)};ABSBiblesearch.prototype.follow=function(path,callback){if(_APIKey===""){_lastError="API Key must be specified.";return false}if(!path||path===""){_lastError="No path specified";return false}if(path.substr(0,1)==="/"){path=path.substr(1)}var url=_baseUrl+path;return this.json(url,callback)};ABSBiblesearch.prototype.networkIsUp=function(){if(navigator.connection&&(navigator.connection.type===Connection.UNKNOWN||navigator.connection.type===Connection.NONE)){if(_debug){console.log("ABS - Network down")}return false}else{if(_debug){console.log("ABS - Network up")}return true}};ABSBiblesearch.prototype.timeout=function(){console.log("ABS Biblesearch timeout")};ABSBiblesearch.prototype.json=function(url,callback,timeout){if(_debug){console.log("ABS json - url: "+url)}callback=callback||function(){};if(!this.networkIsUp()){if(_debug){console.log("ABS json failed.  No network.")}_lastError="Network is not up.";return false}var _xhr=new XMLHttpRequest;_xhr.onreadystatechange=function(){if(_debug){console.log("ABS state: "+_xhr.readyState)}if(_debug&&_xhr.readyState===4){console.log("ABS status: "+_xhr.status)}if(_xhr.readyState===4&&_xhr.status===200){if(_debug){console.log("ABS responseText: "+_xhr.responseText)}var obj=window.plugins.absBiblesearch.parseJSON(_xhr.responseText+"");window.plugins.absBiblesearch.setFumsJs(obj.response.meta.fums_js_include);window.plugins.absBiblesearch.addFums(obj.response.meta.fums_js);callback(obj)}};url=url.replace("//","//"+_APIKey+":x@");_xhr.open("GET",url,_async);if(navigator.userAgent.match(/Android/)){_xhr.setRequestHeader("Authorization","Basic "+btoa(_APIKey+":x"))}_xhr.timeout=1e4;_xhr.ontimeout=timeout?timeout:this.timeout;_xhr.send(null);return true};ABSBiblesearch.prototype.parseJSON=function(data){if(!data||typeof data!=="string"){return null}var rtrim=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g");data=(data+"").replace(rtrim,"");return JSON.parse(data)};ABSBiblesearch.prototype.getFumsJs=function(){return _fumsJs};ABSBiblesearch.prototype.setFumsJs=function(value){_fumsJs=value};ABSBiblesearch.prototype.getFumsJsIncluded=function(){return _fumsJsIncluded};ABSBiblesearch.prototype.setFumsJsIncluded=function(value){_fumsJsIncluded=value};ABSBiblesearch.prototype.getFumsInterval=function(){return _fumsInterval};ABSBiblesearch.prototype.setFumsInterval=function(value){if(value===null&&_fumsInterval!==null){clearInterval(_fumsInterval)}_fumsInterval=value};ABSBiblesearch.prototype.suppressFumsInjection=function(flag){if(flag===null){flag=true}_fumsInjectionSuppression=flag};ABSBiblesearch.prototype.injectFumsJs=function(){if(_fumsInjectionSuppression){return false}if(!_fumsJsIncluded&&this.networkIsUp()){var head=document.getElementsByTagName("head")[0];var script=document.createElement("script");script.src="http://"+_fumsJs;script.id="FumsJs";head.insertBefore(script,head.firstChild);_fumsJsIncluded=true}return _fumsJsIncluded};ABSBiblesearch.prototype.addFums=function(data){if(data.indexOf("var")!==0){data="var _BAPI=_BAPI||{};if(typeof(_BAPI.t)!='undefined'){ _BAPI.t('"+data+"'); }"}var _fums;if(localStorage.getItem("absFums")===null){_fums=[]}else{_fums=JSON.parse(window.localStorage.getItem("absFums"))}_fums.push(data);window.localStorage.setItem("absFums",JSON.stringify(_fums));return window.plugins.absBiblesearch.flushFums()};ABSBiblesearch.prototype.getFums=function(){var _fums;if(localStorage.getItem("absFums")===null){return null}else{_fums=JSON.parse(window.localStorage.getItem("absFums"))}var val=_fums.shift();if(_fums.length===0){window.localStorage.removeItem("absFums")}else{window.localStorage.setItem("absFums",JSON.stringify(_fums))}return val};ABSBiblesearch.prototype.flushFums=function(){if(!this.networkIsUp()){_fumsInterval=setInterval(window.plugins.absBiblesearch.flushFums,2*60*1e3);_lastError="Network is not up.";return false}if(_fumsInterval!==null){clearInterval(_fumsInterval);_fumsInterval=null}if(!this.injectFumsJs()){_lastError="Fums js could not be injected.  This must happen first.";return false}var _fums;if(localStorage.getItem("absFums")===null){return true}else{_fums=JSON.parse(window.localStorage.getItem("absFums"))}for(i=0;i<_fums.length;i++){var script=document.createElement("script");script.innerHTML=_fums[i];document.body.appendChild(script)}window.localStorage.removeItem("absFums");return true};if(!window.plugins){window.plugins={}}window.plugins.absBiblesearch=new ABSBiblesearch;return window.plugins.absBiblesearch}();